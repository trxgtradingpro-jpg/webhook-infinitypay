{% extends "layout.html" %}
{% block title %}RelatÃ³rios{% endblock %}

{% block content %}

<!-- ================= HEADER ================= -->
<div class="header">
  <div>
    <h1>RelatÃ³rios</h1>
    <span>AnÃ¡lises estratÃ©gicas e inteligÃªncia do negÃ³cio</span>
  </div>
</div>

<!-- ================= KPI CARDS ================= -->
<div class="cards">

  <div class="card">
    <h3>Faturamento Mensal</h3>
    <p>R$ {{ faturamento_mensal }}</p>
  </div>

  <div class="card">
    <h3>Crescimento</h3>
    <p style="color:#22c55e">+{{ crescimento }}%</p>
  </div>

  <div class="card">
    <h3>Plano Mais Vendido</h3>
    <p>{{ plano_top }}</p>
  </div>

  <div class="card">
    <h3>ConversÃ£o</h3>
    <p>{{ conversao }}%</p>
  </div>

</div>

<!-- ================= GRID ================= -->
<div style="display:grid;grid-template-columns:2fr 2fr;gap:30px;">

  <!-- LINE CHART -->
  <div class="panel">
    <h2>ğŸ“Š Faturamento ao Longo do Tempo</h2>
    <canvas id="lineChart"></canvas>
  </div>

  <!-- PIE CHART -->
  <div class="panel">
    <h2>ğŸ¥§ Vendas por Plano</h2>
    <canvas id="pieChart"></canvas>
  </div>

</div>

<!-- ================= INSIGHTS ================= -->
<div class="panel">
  <h2>ğŸ§  Insights AutomÃ¡ticos</h2>

  <ul style="line-height:1.8;color:#e5e7eb;">
    <li>ğŸ”¥ O plano <strong>{{ plano_top }}</strong> representa a maior parte das vendas.</li>
    <li>ğŸ“ˆ Houve crescimento consistente nos Ãºltimos dias.</li>
    <li>ğŸ’¡ A taxa de conversÃ£o estÃ¡ acima da mÃ©dia do mercado.</li>
    <li>ğŸš€ Melhor dia de vendas: <strong>{{ melhor_dia }}</strong>.</li>
  </ul>
</div>

<!-- ================= TRENDS ================= -->
<div class="panel">
  <h2>ğŸ“… TendÃªncia por Dia</h2>

  <table class="table">
    <thead>
      <tr>
        <th>Dia</th>
        <th>Vendas</th>
        <th>Faturamento</th>
        <th>Status</th>
      </tr>
    </thead>

    <tbody>
      {% for d in dias %}
      <tr>
        <td>{{ d.dia }}</td>
        <td>{{ d.vendas }}</td>
        <td>R$ {{ d.valor }}</td>
        <td style="color:#22c55e">Alta</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ================= FOOTER ================= -->
<div class="footer">
  Â© 2026 TRX Trading â€¢ RelatÃ³rios EstratÃ©gicos
</div>

<!-- ================= JS ================= -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  // LINE
  new Chart(document.getElementById("lineChart"), {
    type: "line",
    data: {
      labels: {{ chart_labels | safe }},
      datasets: [{
        data: {{ chart_values | safe }},
        borderColor: "#22c55e",
        backgroundColor: "rgba(34,197,94,.15)",
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display:false } }
    }
  });

  // PIE
  new Chart(document.getElementById("pieChart"), {
    type: "doughnut",
    data: {
      labels: {{ planos_labels | safe }},
      datasets: [{
        data: {{ planos_values | safe }},
        backgroundColor: [
          "#22c55e",
          "#38bdf8",
          "#facc15",
          "#ef4444"
        ]
      }]
    },
    options: {
      plugins: { legend: { position:"bottom" } }
    }
  });

});
</script>

{% endblock %}
